<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Baklava Rulet</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    body {
      margin: 0;
      background-color: #8b0000;
      font-family: sans-serif;
      color: white;
      text-align: center;
    }
    h1 { color: gold; font-size: 3em; margin-top: 40px; }
    .hidden { display: none; }
    input, button { padding: 10px; font-size: 1em; margin: 10px; }
    button {
      background-color: gold;
      color: #8b0000;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    .grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }
    .box {
      width: 100px;
      height: 100px;
      background: black;
      border-radius: 10px;
      color: white;
      font-size: 2em;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: relative;
    }
    .box img {
      width: 100%; height: 100%; object-fit: cover; border-radius: 10px;
      display: none;
    }
    .box.revealed img { display: block; }
    .box.revealed::before { content: none; }
  </style>
</head>
<body>
  <h1>Baklava Show</h1>

  <div id="mainMenu">
    <button onclick="showUpload()">Fotoğraf Yükle</button>
    <button onclick="waitForRulet()">Rulet</button>
  </div>

  <div id="uploadMenu" class="hidden">
    <h2>6 Fotoğraf Yükle</h2>
    <div class="grid">
      <input type="file" id="img0" accept="image/*">
      <input type="file" id="img1" accept="image/*">
      <input type="file" id="img2" accept="image/*">
      <input type="file" id="img3" accept="image/*">
      <input type="file" id="img4" accept="image/*">
      <input type="file" id="img5" accept="image/*">
    </div>
    <button onclick="sendImages()">Ruleti Başlat</button>
  </div>

  <div id="waitingMenu" class="hidden">
    <h2>Bekleniyor...</h2>
  </div>

  <div id="ruletMenu" class="hidden">
    <h2>Bir Fotoğraf Seç</h2>
    <div id="ruletBoxes" class="grid"></div>
  </div>

  <script>
    const socket = io();

    function showUpload() {
      document.getElementById('mainMenu').classList.add('hidden');
      document.getElementById('uploadMenu').classList.remove('hidden');
    }

    function waitForRulet() {
      document.getElementById('mainMenu').classList.add('hidden');
      document.getElementById('waitingMenu').classList.remove('hidden');
      socket.emit('wait-for-rulet');
    }

    function sendImages() {
      const files = [];
      for (let i = 0; i < 6; i++) {
        const file = document.getElementById(`img${i}`).files[0];
        if (!file) return alert("Tüm görselleri yükle aşkito!");
        files.push(file);
      }
      const readers = files.map(file => new Promise(res => {
        const reader = new FileReader();
        reader.onload = () => res(reader.result);
        reader.readAsDataURL(file);
      }));
      Promise.all(readers).then(images => {
        socket.emit('send-images', images);
        document.getElementById('uploadMenu').classList.add('hidden');
        document.getElementById('waitingMenu').classList.remove('hidden');
      });
    }

    socket.on('show-images', (images) => {
      document.getElementById('waitingMenu').classList.add('hidden');
      document.getElementById('ruletMenu').classList.remove('hidden');
      const ruletBoxes = document.getElementById('ruletBoxes');
      ruletBoxes.innerHTML = '';
      images.forEach((img, i) => {
        const div = document.createElement('div');
        div.classList.add('box');
        div.innerHTML = `<img src="${img}" /><span>?</span>`;
        div.onclick = () => selectImage(div, img);
        ruletBoxes.appendChild(div);
      });
    });

    function selectImage(div, imgSrc) {
      const boxes = document.querySelectorAll('.box');
      boxes.forEach(b => {
        b.onclick = null;
        b.style.opacity = '0.3';
      });
      div.classList.add('revealed');
      div.style.opacity = '1';

      setTimeout(() => {
        location.reload();
      }, 5000);
    }
  </script>
</body>
</html>
